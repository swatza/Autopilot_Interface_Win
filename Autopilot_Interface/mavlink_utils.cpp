#include <stdio.h>
#include "common/mavlink.h"

#include "mavlink_utils.h"


/*
* Set target local ned position
*
* Modifies a mavlink_set_position_target_local_ned_t struct with target XYZ locations
* in the Local NED frame, in meters.
*/
void
set_position(float x, float y, float z, mavlink_set_position_target_local_ned_t &sp)
{
	sp.type_mask = MAVLINK_MSG_SET_POSITION_TARGET_LOCAL_NED_POSITION;
	sp.coordinate_frame = MAV_FRAME_LOCAL_NED;

	sp.x = x;
	sp.y = y;
	sp.z = z;

	printf("POSITION SETPOITN XYZ = [%.4f, %.4f, %.4f] \n", sp.x, sp.y, sp.z);
}

/*
* Set target local ned velocity
*
* Modifies a mavlink_set_position_target_local_ned_t struct with target VX VY VZ
* velocities in the Local NED frame, in meters per second.
*/
void
set_velocity(float vx, float vy, float vz, mavlink_set_position_target_local_ned_t &sp)
{
	sp.type_mask =
		MAVLINK_MSG_SET_POSITION_TARGET_LOCAL_NED_VELOCITY;

	sp.coordinate_frame = MAV_FRAME_LOCAL_NED;

	sp.vx = vx;
	sp.vy = vy;
	sp.vz = vz;

	//printf("VELOCITY SETPOINT UVW = [ %.4f , %.4f , %.4f ] \n", sp.vx, sp.vy, sp.vz);
}

/*
* Set target local ned acceleration
*
* Modifies a mavlink_set_position_target_local_ned_t struct with target AX AY AZ
* accelerations in the Local NED frame, in meters per second squared.
*/
void
set_acceleration(float ax, float ay, float az, mavlink_set_position_target_local_ned_t &sp)
{

	// NOT IMPLEMENTED
	fprintf(stderr, "set_acceleration doesn't work yet \n");
	throw 1;


	sp.type_mask =
		MAVLINK_MSG_SET_POSITION_TARGET_LOCAL_NED_ACCELERATION &
		MAVLINK_MSG_SET_POSITION_TARGET_LOCAL_NED_VELOCITY;

	sp.coordinate_frame = MAV_FRAME_LOCAL_NED;

	sp.afx = ax;
	sp.afy = ay;
	sp.afz = az;
}

// the next two need to be called after one of the above

/*
* Set target local ned yaw
*
* Modifies a mavlink_set_position_target_local_ned_t struct with a target yaw
* in the Local NED frame, in radians.
*/
void
set_yaw(float yaw, mavlink_set_position_target_local_ned_t &sp)
{
	sp.type_mask &=
		MAVLINK_MSG_SET_POSITION_TARGET_LOCAL_NED_YAW_ANGLE;

	sp.yaw = yaw;

	printf("POSITION SETPOINT YAW = %.4f \n", sp.yaw);
}

/*
* Set target local ned yaw rate
*
* Modifies a mavlink_set_position_target_local_ned_t struct with a target yaw rate
* in the Local NED frame, in radians per second.
*/
void
set_yaw_rate(float yaw_rate, mavlink_set_position_target_local_ned_t &sp)
{
	sp.type_mask &=
		MAVLINK_MSG_SET_POSITION_TARGET_LOCAL_NED_YAW_RATE;

	sp.yaw_rate = yaw_rate;
}